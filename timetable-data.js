// 時間表數據
window.TIMETABLE_DATA = {
    // 正常時間表
    normal: {
        // 预校朝会时间
        preSchoolAssembly: {
            start: "08:15",
            end: "08:40",
            name: "Pre-School Assembly"
        },
        
        // 正常课程时间
        periods: [
            { start: "08:40", end: "09:20" },
            { start: "09:20", end: "10:00" },
            { start: "10:20", end: "11:00" }, // 第3节，考虑了小息
            { start: "11:00", end: "11:40" },
            { start: "12:50", end: "13:30" }, // 第5节，考虑了午餐
            { start: "13:30", end: "14:10" },
            { start: "14:25", end: "15:05" }, // 第7节，考虑了小息
            { start: "15:05", end: "15:45" }
        ],
        
        // 小息和午餐时间
        breaks: [
            { start: "10:00", end: "10:20", name: "小息" },
            { start: "11:40", end: "12:50", name: "午餐" },
            { start: "14:10", end: "14:25", name: "小息" }
        ]
    },
    
    // 特殊時間表A (3-10/9)
    specialA: {
        periods: [
            { start: "08:30", end: "09:00" },
            { start: "09:00", end: "09:30" },
            { start: "09:50", end: "10:20" },
            { start: "10:20", end: "10:50" },
            { start: "11:05", end: "11:35" },
            { start: "11:35", end: "12:05" },
            { start: "13:15", end: "13:45" },
            { start: "13:45", end: "14:15" }
        ],
        breaks: [
            { start: "09:30", end: "09:50", name: "小息" },
            { start: "10:50", end: "11:05", name: "小息" },
            { start: "12:05", end: "13:10", name: "午餐" },
            { start: "13:10", end: "13:15", name: "點名" }
        ]
    },
    
    // 特殊時間表B (所有星期五和特殊活動)
    specialB: {
        periods: [
            { start: "08:30", end: "09:05" },
            { start: "09:05", end: "09:40" },
            { start: "10:00", end: "10:35" },
            { start: "10:35", end: "11:10" },
            { start: "11:25", end: "12:00" },
            { start: "12:00", end: "12:35" },
            { start: "13:45", end: "14:20" },
            { start: "14:20", end: "14:55" }
        ],
        breaks: [
            { start: "09:40", end: "10:00", name: "小息" },
            { start: "11:10", end: "11:25", name: "小息" },
            { start: "12:35", end: "13:40", name: "午餐" },
            { start: "13:40", end: "13:45", name: "點名" },
            { start: "14:55", end: "15:45", name: "集會" }
        ]
    },
    
    // 特殊時間表C (某些特殊活動)
    specialC: {
        periods: [
            { start: "08:30", end: "09:00" },
            { start: "09:00", end: "09:30" },
            { start: "09:50", end: "10:20" },
            { start: "10:20", end: "10:50" },
            { start: "11:05", end: "11:35" },
            { start: "11:35", end: "12:05" },
            { start: "13:15", end: "13:45" },
            { start: "13:45", end: "14:15" }
        ],
        breaks: [
            { start: "09:30", end: "09:50", name: "小息" },
            { start: "10:50", end: "11:05", name: "小息" },
            { start: "12:05", end: "13:10", name: "午餐" },
            { start: "13:10", end: "13:15", name: "點名" },
            { start: "14:15", end: "15:45", name: "長集會" }
        ]
    },
    
    // 特殊時間表D (社際聚會)
    specialD: {
        periods: [
            { start: "08:30", end: "09:10" },
            { start: "09:10", end: "09:50" },
            { start: "10:10", end: "10:50" },
            { start: "10:50", end: "11:30" },
            { start: "13:10", end: "13:45" },
            { start: "13:45", end: "14:20" },
            { start: "14:35", end: "15:10" },
            { start: "15:10", end: "15:45" }
        ],
        breaks: [
            { start: "09:50", end: "10:10", name: "小息" },
            { start: "11:30", end: "13:05", name: "午餐/社際聚會" },
            { start: "13:05", end: "13:10", name: "點名" },
            { start: "14:20", end: "14:35", name: "小息" }
        ]
    },
    
    // 特殊時間表E (資訊日準備)
    specialE: {
        periods: [
            { start: "08:30", end: "09:00" },
            { start: "09:00", end: "09:30" },
            { start: "09:45", end: "10:15" },
            { start: "10:15", end: "10:45" },
            { start: "10:55", end: "11:25" },
            { start: "11:25", end: "11:55" },
            { start: "12:05", end: "12:35" },
            { start: "12:35", end: "13:05" }
        ],
        breaks: [
            { start: "09:30", end: "09:45", name: "小息" },
            { start: "10:45", end: "10:55", name: "小息" },
            { start: "11:55", end: "12:05", name: "小息" }
        ]
    }
};

// 科目時間表 (Day 1-6)
window.SUBJECT_SCHEDULE = {
    1: {
        1: "MATH YPC 405",
        2: "MATH YPC 405", 
        3: "PHY WKW 511",
        4: "PHY WKW 511",
        5: "C&L CYM 405",
        6: "ENG KKY 405",
        7: "CHIN NKT 405",
        8: "CHIN NKT 405"
    },
    2: {
        1: "LAC KKY 405",
        2: "CS LPY 405",
        3: "M2 YPC 405",
        4: "M2 YPC 405",
        5: "CHIN NKT 405",
        6: "CHIN NKT 405",
        7: "ICT WKC 316",
        8: "ICT WKC 316"
    },
    3: {
        1: "PHY WKW 511",
        2: "PHY WKW 511",
        3: "PE CWH,KSM GD01",
        4: "PE CWH,KSM GD01",
        5: "CHIN NKT 405",
        6: "MATH YPC 405",
        7: "ENG KKY 405",
        8: "ENG KKY 405"
    },
    4: {
        1: "HEPL TMC,KTT 405",
        2: "HEPL TMC,KTT 405",
        3: "ICT WKC 316",
        4: "ICT WKC 316",
        5: "ENG KKY 405",
        6: "CHIN NKT 405",
        7: "MATH YPC 405",
        8: "MATH YPC 405"
    },
    5: {
        1: "CHIN NKT 405",
        2: "CHIN NKT 405",
        3: "C&L CYM 405",
        4: "ENG KKY 405",
        5: "M2 YPC 405",
        6: "M2 YPC 405",
        7: "CS LPY 405",
        8: "CS LPY 405"
    },
    6: {
        1: "ICT WKC 316",
        2: "ICT WKC 316",
        3: "ENG KKY 405",
        4: "ENG KKY 405",
        5: "PHY WKW 511",
        6: "PHY WKW 511",
        7: "MATH YPC 405",
        8: "MATH YPC 405"
    }
};

// 日期輪換規則
window.DAY_ROTATION = {
    "2025-09-03": 1, "2025-09-04": 2, "2025-09-05": 3, "2025-09-08": 4, "2025-09-09": 5, "2025-09-10": 6,
    "2025-09-11": 1, "2025-09-12": 2, "2025-09-15": 3, "2025-09-16": 4, "2025-09-17": 5, "2025-09-18": 6,
    "2025-09-19": 1, "2025-09-22": 2, "2025-09-23": 3, "2025-09-24": 4, "2025-09-26": 5, "2025-09-29": 6,
    "2025-09-30": 1, "2025-10-02": 2, "2025-10-03": 3, "2025-10-06": 4, "2025-10-08": 5, "2025-10-09": 6,
    "2025-10-13": 1, "2025-10-14": 2, "2025-10-15": 3, "2025-10-16": 4, "2025-10-17": 5, "2025-10-20": 6,
    "2025-10-21": 1, "2025-10-22": 2, "2025-10-23": 3, "2025-10-24": 4, "2025-10-27": 5, "2025-10-28": 6,
    "2025-10-30": 1, "2025-10-31": 2, "2025-11-03": 3, "2025-11-04": 4, "2025-11-05": 5, "2025-11-06": 6,
    "2025-11-07": 1, "2025-11-10": 2, "2025-11-11": 3, "2025-11-12": 4, "2025-11-13": 5, "2025-11-14": 6,
    "2025-11-17": 1, "2025-11-18": 2, "2025-11-19": 3, "2025-11-20": 4, "2025-11-24": 5, "2025-11-25": 6,
    "2025-11-26": 1, "2025-11-27": 2, "2025-11-28": 3, "2025-12-02": 4, "2025-12-03": 5, "2025-12-04": 6,
    "2025-12-05": 1, "2025-12-09": 2, "2025-12-10": 3, "2025-12-11": 4, "2025-12-12": 5, "2025-12-15": 6,
    "2025-12-16": 1, "2025-12-17": 2, "2025-12-18": 3, "2026-01-02": 4, "2026-01-05": 5, "2026-01-06": 6,
    "2026-01-22": 1, "2026-01-23": 2, "2026-01-26": 3, "2026-01-30": 4, "2026-02-02": 5, "2026-02-03": 6,
    "2026-02-04": 1, "2026-02-05": 2, "2026-02-06": 3, "2026-02-09": 4, "2026-02-10": 5, "2026-02-11": 6,
    "2026-02-12": 1, "2026-02-25": 2, "2026-02-26": 3, "2026-02-27": 4, "2026-03-02": 5, "2026-03-03": 6,
    "2026-03-04": 1, "2026-03-05": 2, "2026-03-06": 3, "2026-03-10": 4, "2026-03-11": 5, "2026-03-12": 6,
    "2026-03-13": 1, "2026-03-16": 2, "2026-03-17": 3, "2026-03-18": 4, "2026-03-19": 5, "2026-03-20": 6,
    "2026-03-23": 1, "2026-03-24": 2, "2026-03-25": 3, "2026-03-26": 4, "2026-04-09": 5, "2026-04-17": 6,
    "2026-04-20": 1, "2026-04-21": 2, "2026-04-22": 3, "2026-04-23": 4, "2026-04-27": 5, "2026-04-28": 6,
    "2026-04-29": 1, "2026-04-30": 2, "2026-05-04": 3, "2026-05-05": 4, "2026-05-06": 5, "2026-05-07": 6,
    "2026-05-08": 1, "2026-05-11": 2, "2026-05-12": 3, "2026-05-13": 4, "2026-05-14": 5, "2026-05-15": 6,
    "2026-05-19": 1, "2026-05-20": 2, "2026-05-21": 3, "2026-05-22": 4, "2026-05-26": 5, "2026-05-27": 6,
    "2026-05-28": 1, "2026-05-29": 2, "2026-06-01": 3, "2026-06-02": 4, "2026-06-03": 5, "2026-06-04": 6
};

// 特殊日期規則
window.SPECIAL_DATES = {
    // 特殊時間表A
    "2025-09-03": "A", "2025-09-04": "A", "2025-09-05": "A", "2025-09-08": "A", 
    "2025-09-09": "A", "2025-09-10": "A",
    
    // 特殊時間表B
    "2025-09-12": "B", // 開學禮
    "2025-12-12": "C", // 跳繩比賽
    "2026-02-03": "C", // 歡送中六畢業生
    "2026-02-12": "B", // 中華文化週
    "2026-03-26": "B", // 復活節崇拜
    "2026-04-30": "C", // SA諮詢會
    "2026-05-08": "D", // 社際聚會
    "2026-05-15": "B", // 頒獎典禮準備
    "2025-11-14": "C", // 福音聚會
    "2025-11-28": "E", // 資訊日準備
    
    // 學習雙週期 (19/05 - 04/06/2026)
    "2026-05-19": "B", "2026-05-20": "B", "2026-05-21": "B", "2026-05-22": "B",
    "2026-05-26": "B", "2026-05-27": "B", "2026-05-28": "B", "2026-05-29": "B",
    "2026-06-01": "B", "2026-06-02": "B", "2026-06-03": "B", "2026-06-04": "B"
};

// 星期五規則：所有星期五使用特殊時間表B
function isFriday(dateStr) {
    const date = new Date(dateStr);
    return date.getDay() === 5; // 5 = Friday
}

// 獲取當天應使用的時間表類型
function getTimetableType(dateStr) {
    // 檢查是否為特殊日期
    if (SPECIAL_DATES[dateStr]) {
        return SPECIAL_DATES[dateStr];
    }
    
    // 檢查是否為星期五
    if (isFriday(dateStr)) {
        return "B";
    }
    
    // 默認使用正常時間表
    return "normal";
}

// 獲取當天的Day週期
function getDayCycle(dateStr) {
    return DAY_ROTATION[dateStr] || null;
}